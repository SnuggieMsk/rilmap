<!DOCTYPE html>
<html lang="en">
<head>
  <title>RIL Global Strategy Visualization</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    /* Modern CSS Reset & Base Styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: #1F2937;
      line-height: 1.6;
      background-color: #f8f9fa;
      font-size: 16px;
    }
    
    /* Enhanced Color Variables */
    :root {
      --primary: #0047AB;
      --primary-dark: #003380;
      --primary-light: #E6F0FF;
      --secondary: #6B7280;
      --secondary-light: #F3F4F6;
      --success: #10B981;
      --success-light: #ECFDF5;
      --info: #3B82F6;
      --info-light: #EFF6FF;
      --warning: #F59E0B;
      --warning-light: #FFFBEB;
      --danger: #EF4444;
      --danger-light: #FEF2F2;
      --light: #F9FAFB;
      --dark: #111827;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      --white: #FFFFFF;
      --box-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --box-shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --box-shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --transition-fast: all 0.2s ease;
      --transition: all 0.3s ease;
      --transition-slow: all 0.5s ease;
      --border-radius-sm: 0.25rem;
      --border-radius: 0.375rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 0.75rem;
      --border-radius-xl: 1rem;
      --border-radius-2xl: 1.5rem;
      --border-radius-full: 9999px;
      
      /* Chat-specific colors */
      --chat-primary: #0047AB;
      --chat-secondary: #F3F4F6;
      --chat-accent: #10B981;
      --chat-text: #1F2937;
      --chat-light-text: #6B7280;
      --chat-bg: #F9FAFB;
    }
    
    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      margin-top: 0;
      font-weight: 600;
      color: var(--gray-800);
      line-height: 1.3;
    }
    
    h1 { font-size: 1.875rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }
    h4 { font-size: 1.125rem; }
    h5 { font-size: 1rem; }
    h6 { font-size: 0.875rem; }
    
    p {
      margin-top: 0;
      margin-bottom: 1rem;
    }
    
    a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition-fast);
    }
    
    a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    /* Layout */
    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    /* Navigation bar */
    #navbar {
      background: var(--primary);
      color: var(--white);
      padding: 0.75rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--box-shadow);
      z-index: 10;
    }
    
    .brand {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      letter-spacing: -0.025em;
    }
    
    .brand i {
      margin-right: 0.625rem;
      font-size: 1.375rem;
    }
    
    .nav-tabs {
      display: flex;
      gap: 0.125rem;
    }
    
    #navbar button {
      background: transparent;
      border: none;
      padding: 0.625rem 1rem;
      color: rgba(255,255,255,0.85);
      cursor: pointer;
      border-radius: var(--border-radius);
      transition: var(--transition-fast);
      font-weight: 500;
      font-size: 0.9375rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    #navbar button.active, #navbar button:hover {
      background: rgba(255,255,255,0.15);
      color: var(--white);
    }
    
    #navbar button i {
      font-size: 1rem;
    }
    
    /* Container for each view */
    .views-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }
    
    .view {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 0;
      transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
      transform: translateX(100%);
      opacity: 0;
    }
    
    .view.active {
      display: block;
      transform: translateX(0);
      opacity: 1;
    }
    
    /* Map view layout */
    #view-map {
      display: flex;
      height: 100%;
    }
    
    #sidebar {
      width: 350px;
      background: var(--white);
      padding: 1.25rem;
      overflow-y: auto;
      box-shadow: var(--box-shadow);
      z-index: 5;
      transition: var(--transition);
    }
    
    .sidebar-toggle {
      display: none;
      position: absolute;
      left: 350px;
      top: 15px;
      background: var(--white);
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-full);
      width: 38px;
      height: 38px;
      text-align: center;
      line-height: 38px;
      z-index: 1000;
      cursor: pointer;
      box-shadow: var(--box-shadow);
      transition: var(--transition-fast);
    }
    
    .sidebar-toggle:hover {
      background: var(--primary-light);
      color: var(--primary);
      transform: scale(1.05);
    }
    
    #map {
      flex-grow: 1;
    }
    
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      border-bottom: 2px solid var(--primary-light);
      padding-bottom: 0.875rem;
    }
    
    .sidebar-header h2 {
      margin: 0;
      font-size: 1.25rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Filter UI styles */
    .filter-group {
      margin-bottom: 1.5rem;
      background: var(--gray-100);
      padding: 1.25rem;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--box-shadow-sm);
      border: 1px solid var(--gray-200);
    }
    
    .filter-title {
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      color: var(--gray-800);
      font-size: 1.0625rem;
    }
    
    .filter-title i {
      margin-right: 0.625rem;
      color: var(--primary);
      font-size: 1.125rem;
    }
    
    .filter-group label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 500;
      font-size: 0.9375rem;
      color: var(--gray-700);
    }
    
    .filter-option {
      display: flex;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .filter-option:last-child {
      margin-bottom: 0;
    }
    
    .filter-group input[type="checkbox"] {
      margin-right: 0.625rem;
      width: 1.125rem;
      height: 1.125rem;
      cursor: pointer;
    }
    
    .filter-group select, .filter-group input[type="range"] {
      width: 100%;
      padding: 0.625rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius);
      background: var(--white);
      font-size: 0.9375rem;
      transition: var(--transition-fast);
    }
    
    .filter-group select:focus, .filter-group input[type="range"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }
    
    .filter-group select {
      height: 40px;
      cursor: pointer;
      color: var(--gray-700);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.625rem center;
      background-size: 1rem;
      padding-right: 2.5rem;
    }
    
    .slider-container {
      display: flex;
      flex-direction: column;
    }
    
    .slider-container .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }
    
    .slider-container input[type="range"] {
      padding: 0;
      height: 6px;
      background: var(--gray-300);
      border: none;
      border-radius: var(--border-radius-full);
      cursor: pointer;
      -webkit-appearance: none;
    }
    
    .slider-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      border: 2px solid var(--white);
      box-shadow: 0 0 0 1px var(--gray-300);
      transition: var(--transition-fast);
    }
    
    .slider-container input[type="range"]::-webkit-slider-thumb:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
    }
    
    .time-value {
      font-weight: 600;
      color: var(--primary);
      padding: 0.25rem 0.5rem;
      background: var(--primary-light);
      border-radius: var(--border-radius);
      display: inline-block;
    }
    
    hr {
      border: none;
      border-top: 1px solid var(--gray-200);
      margin: 1.75rem 0;
    }
    
    /* Marker list styling */
    #markerList {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 1.25rem;
      padding-right: 0.5rem;
    }
    
    .marker-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .marker-list-header h3 {
      margin: 0;
      color: var(--gray-800);
      font-size: 1.125rem;
    }
    
    .marker-list-header .marker-count {
      color: var(--gray-500);
      font-size: 0.875rem;
      background: var(--gray-100);
      padding: 0.25rem 0.625rem;
      border-radius: var(--border-radius-full);
      font-weight: 500;
    }
    
    .marker-item {
      cursor: pointer;
      margin-bottom: 1rem;
      padding: 1rem;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-lg);
      background: var(--white);
      transition: var(--transition);
      box-shadow: var(--box-shadow-sm);
    }
    
    .marker-item:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--box-shadow-md);
      border-color: var(--primary-light);
    }
    
    .marker-item .title {
      font-weight: 600;
      margin-bottom: 0.375rem;
      display: flex;
      justify-content: space-between;
      color: var(--gray-800);
    }
    
    .marker-item .title .year {
      color: var(--primary);
      font-size: 0.875rem;
      font-weight: 500;
      background: var(--primary-light);
      padding: 0.125rem 0.5rem;
      border-radius: var(--border-radius);
    }
    
    .marker-badges {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
    }
    
    .marker-item .type-badge {
      display: inline-block;
      padding: 0.125rem 0.625rem;
      border-radius: var(--border-radius-full);
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .type-badge.operation {
      background: var(--info-light);
      color: var(--info);
    }
    
    .type-badge.partnership {
      background: #FCE7F3; /* Pink light */
      color: #DB2777; /* Pink */
    }
    
    .type-badge.opportunity {
      background: var(--success-light);
      color: var(--success);
    }
    
    .type-badge.current {
      background: var(--primary-light);
      color: var(--primary);
    }
    
    .type-badge.past {
      background: var(--gray-100);
      color: var(--gray-500);
    }
    
    .type-badge.future {
      background: var(--warning-light);
      color: var(--warning);
    }
    
    .marker-item .description {
      font-size: 0.875rem;
      color: var(--gray-600);
      line-height: 1.5;
    }
    
    /* Map legends */
    .legend {
      background: white;
      padding: 0.75rem 1rem;
      font: 14px/1.5 'Inter', sans-serif;
      box-shadow: var(--box-shadow);
      border-radius: var(--border-radius);
      border: 1px solid var(--gray-200);
    }
    
    .legend h4 {
      margin: 0 0 0.625rem;
      font-size: 0.9375rem;
      color: var(--gray-800);
      padding-bottom: 0.375rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .legend div {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
      font-size: 0.8125rem;
    }
    
    .legend i {
      width: 16px;
      height: 16px;
      margin-right: 0.5rem;
      opacity: 0.8;
      border-radius: var(--border-radius);
      display: inline-block;
    }
    
    /* Timeline view */
    #view-timeline {
      display: flex;
      height: 100%;
    }
    
    #timelineContent {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    
    .timeline-header {
      margin-bottom: 2rem;
    }
    
    .timeline-header h2 {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.625rem;
    }
    
    .timeline-header p {
      color: var(--gray-600);
      max-width: 800px;
    }
    
    .timeline-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--primary-light);
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius);
      margin-top: 1rem;
      max-width: 800px;
      color: var(--primary);
      font-size: 0.875rem;
    }
    
    .timeline-info i {
      font-size: 1rem;
    }
    
    .timeline-controls {
      background: var(--white);
      padding: 1.25rem;
      margin-bottom: 2rem;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--box-shadow);
      border: 1px solid var(--gray-200);
    }
    
    .timeline {
      position: relative;
      margin: 3rem 0;
      padding-left: 2.5rem;
    }
    
    .timeline::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      width: 4px;
      background: var(--primary);
      border-radius: var(--border-radius-full);
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 2.5rem;
      padding: 1.5rem;
      background: var(--white);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--box-shadow);
      border: 1px solid var(--gray-200);
      transition: var(--transition);
      max-width: 800px;
      opacity: 1;
      transform: translateX(0);
    }
    
    .timeline-item:hover {
      transform: translateX(5px);
      box-shadow: var(--box-shadow-md);
      border-color: var(--primary-light);
    }
    
    .timeline-item.new-entry {
      animation: fadeInSlide 0.8s ease-out;
    }
    
    @keyframes fadeInSlide {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .timeline-placeholder {
      text-align: center;
      color: var(--gray-500);
      font-style: italic;
      margin: 2rem 0;
      padding: 1rem;
    }
    
    .timeline-item::before {
      content: "";
      position: absolute;
      left: -2.5rem;
      top: 1.5rem;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--white);
      border: 4px solid var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
    }
    
    .timeline-item .year {
      display: inline-block;
      padding: 0.375rem 0.875rem;
      border-radius: var(--border-radius-full);
      background: var(--primary);
      color: var(--white);
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }
    
    .timeline-item h3 {
      margin: 0.75rem 0;
      color: var(--gray-800);
    }
    
    .timeline-item p {
      margin-bottom: 0.5rem;
      color: var(--gray-600);
    }
    
    .timeline-badges {
      display: flex;
      gap: 0.5rem;
      margin: 0.5rem 0 1rem;
      flex-wrap: wrap;
    }
    
    /* Strategy view */
    #view-strategy {
      display: flex;
      height: 100%;
    }
    
    #strategyContent {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    
    .strategy-header {
      margin-bottom: 2.5rem;
      text-align: center;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .strategy-header h2 {
      font-size: 1.75rem;
      color: var(--primary);
      margin-bottom: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .strategy-header p {
      color: var(--gray-600);
      font-size: 1.0625rem;
    }
    
    .strategy-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
      margin-bottom: 2.5rem;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .strategy-card {
      background: var(--white);
      border-radius: var(--border-radius-xl);
      padding: 1.75rem;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: 1px solid var(--gray-200);
    }
    
    .strategy-card:hover {
      transform: translateY(-7px);
      box-shadow: var(--box-shadow-lg);
    }
    
    .strategy-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
    }
    
    .strategy-card.short-term::before {
      background: var(--primary);
    }
    
    .strategy-card.medium-term::before {
      background: var(--info);
    }
    
    .strategy-card.long-term::before {
      background: var(--success);
    }
    
    .strategy-card h3 {
      margin-top: 0.75rem;
      margin-bottom: 1.25rem;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      color: var(--gray-800);
    }
    
    .strategy-card h3 i {
      margin-right: 0.75rem;
      color: var(--primary);
      font-size: 1.375rem;
    }
    
    .strategy-card ul {
      padding-left: 1.5rem;
      margin-bottom: 0;
    }
    
    .strategy-card li {
      margin-bottom: 0.875rem;
      color: var(--gray-700);
    }
    
    .strategy-card li:last-child {
      margin-bottom: 0;
    }
    
    /* Details view */
    #view-details {
      display: flex;
      height: 100%;
    }
    
    #detailsContent {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    
    .details-section {
      background: var(--white);
      border-radius: var(--border-radius-xl);
      padding: 1.75rem;
      margin-bottom: 2rem;
      box-shadow: var(--box-shadow);
      border: 1px solid var(--gray-200);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .details-section h2 {
      padding-bottom: 0.875rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 2px solid var(--primary-light);
    }
    
    .details-section h3 {
      margin: 1.75rem 0 1rem;
      color: var(--gray-800);
      font-size: 1.25rem;
      padding-left: 0.75rem;
      border-left: 3px solid var(--primary);
    }
    
    .details-section p {
      color: var(--gray-700);
      line-height: 1.7;
    }
    
    /* Modal for detailed info card */
    #detailModal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(3px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }
    
    #detailModal.show {
      opacity: 1;
    }
    
    #detailModal .modal-content {
      background: var(--white);
      padding: 2rem;
      max-width: 550px;
      width: 90%;
      border-radius: var(--border-radius-xl);
      position: relative;
      transform: translateY(30px);
      transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
      box-shadow: var(--box-shadow-lg);
    }
    
    #detailModal.show .modal-content {
      transform: translateY(0);
    }
    
    #detailModal .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.25rem;
      padding-bottom: 0.875rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    #detailModal .modal-header h3 {
      margin: 0;
      color: var(--primary);
      font-size: 1.375rem;
    }
    
    #detailModal .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-400);
      line-height: 1;
      padding: 0.25rem;
      margin-left: 1rem;
      transition: var(--transition-fast);
      border-radius: var(--border-radius);
    }
    
    #detailModal .close-btn:hover {
      color: var(--danger);
      background: var(--danger-light);
    }
    
    #detailModal .modal-body {
      margin-bottom: 1.75rem;
    }
    
    #detailModal .modal-footer {
      display: flex;
      justify-content: flex-end;
      padding-top: 0.875rem;
      border-top: 1px solid var(--gray-200);
    }
    
    #detailModal .modal-footer button {
      background: var(--primary);
      color: var(--white);
      border: none;
      padding: 0.625rem 1.25rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition-fast);
      font-weight: 500;
      font-size: 0.9375rem;
    }
    
    #detailModal .modal-footer button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }
    
    .detail-item {
      margin-bottom: 1rem;
    }
    
    .detail-item .label {
      font-weight: 600;
      display: inline-block;
      width: 95px;
      color: var(--gray-700);
    }
    
    .detail-item p {
      color: var(--gray-600);
      line-height: 1.6;
    }
    
    .detail-badges {
      display: flex;
      gap: 0.5rem;
      margin: 0.5rem 0;
      flex-wrap: wrap;
    }

    /* CHAT STYLING */
    #view-chat {
      display: flex;
      height: 100%;
    }
    
    .chat-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .chat-header {
      padding: 1rem 1.5rem;
      background: var(--primary);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--box-shadow);
    }
    
    .chat-header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0;
    }
    
    .chat-actions {
      display: flex;
      gap: 0.75rem;
    }
    
    .action-button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-fast);
    }
    
    .action-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    .action-button i {
      font-size: 1rem;
    }
    
    .messages-container {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      scroll-behavior: smooth;
      background-image: 
        radial-gradient(circle at 1px 1px, var(--gray-200) 1px, transparent 0),
        radial-gradient(circle at 1px 1px, var(--gray-200) 1px, transparent 0);
      background-size: 25px 25px;
      background-position: 0 0, 12.5px 12.5px;
      background-color: var(--chat-bg);
    }
    
    .message-wrapper {
      display: flex;
      flex-direction: column;
      max-width: 75%;
    }
    
    .user-message {
      align-self: flex-end;
    }
    
    .bot-message {
      align-self: flex-start;
    }
    
    .message {
      padding: 1rem 1.25rem;
      border-radius: var(--border-radius-xl);
      position: relative;
      line-height: 1.6;
      word-wrap: break-word;
    }
    
    .user-message .message {
      background: var(--primary);
      color: var(--white);
      border-bottom-right-radius: 4px;
      box-shadow: var(--box-shadow);
    }
    
    .bot-message .message {
      background: var(--white);
      color: var(--gray-800);
      border-bottom-left-radius: 4px;
      box-shadow: var(--box-shadow);
      border: 1px solid var(--gray-200);
    }
    
    .message-sender {
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
      font-weight: 500;
    }
    
    .user-message .message-sender {
      text-align: right;
      color: var(--primary-light);
    }
    
    .bot-message .message-sender {
      color: var(--primary);
    }
    
    .timestamp {
      font-size: 0.75rem;
      color: var(--gray-500);
      margin-top: 0.375rem;
    }
    
    .user-message .timestamp {
      align-self: flex-end;
    }
    
    .bot-message .timestamp {
      align-self: flex-start;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      background: var(--white);
      width: fit-content;
      padding: 0.875rem 1.25rem;
      border-radius: var(--border-radius-xl);
      border-bottom-left-radius: 4px;
      box-shadow: var(--box-shadow);
      border: 1px solid var(--gray-200);
    }
    
    .typing-indicator span {
      height: 0.5rem;
      width: 0.5rem;
      background: var(--primary);
      display: block;
      border-radius: 50%;
      opacity: 0.5;
    }
    
    .typing-indicator span:nth-child(1) {
      animation: pulse 1.5s infinite ease-in-out;
    }
    
    .typing-indicator span:nth-child(2) {
      animation: pulse 1.5s infinite ease-in-out 0.3s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation: pulse 1.5s infinite ease-in-out 0.6s;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    
    .chat-input-container {
      padding: 1.25rem;
      background: var(--white);
      border-top: 1px solid var(--gray-200);
      display: flex;
      flex-direction: column;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    
    .chat-input-row {
      display: flex;
      align-items: flex-end;
    }
    
    .chat-input {
      flex: 1;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius-xl);
      padding: 0.875rem 1.25rem;
      background: var(--white);
      font-size: 1rem;
      color: var(--gray-800);
      transition: var(--transition-fast);
      outline: none;
      resize: none;
      max-height: 150px;
      line-height: 1.5;
      min-height: 44px;
      box-shadow: var(--box-shadow-sm);
    }
    
    .chat-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }
    
    .send-button {
      background: var(--primary);
      border: none;
      color: var(--white);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      margin-left: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-fast);
      box-shadow: var(--box-shadow);
    }
    
    .send-button:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: var(--box-shadow-md);
    }
    
    .send-button:active {
      transform: scale(0.95);
    }
    
    .send-button:disabled {
      background: var(--gray-400);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .system-message {
      text-align: center;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      border-radius: var(--border-radius-xl);
      font-size: 0.875rem;
      color: var(--gray-500);
      background: rgba(0, 0, 0, 0.03);
      width: fit-content;
      align-self: center;
      border: 1px solid var(--gray-200);
    }
    
    .error-message {
      color: var(--danger);
      background: var(--danger-light);
      border-color: var(--danger-light);
    }
    
    /* Markdown-like formatting */
    .markdown-content {
      white-space: pre-wrap;
    }

    .markdown-content em {
      font-style: italic;
    }

    .markdown-content strong {
      font-weight: 600;
    }

    .markdown-content h1, .markdown-content h2, .markdown-content h3 {
      font-weight: 600;
      margin: 1rem 0 0.5rem;
    }

    .markdown-content h1 {
      font-size: 1.375rem;
    }

    .markdown-content h2 {
      font-size: 1.25rem;
    }

    .markdown-content h3 {
      font-size: 1.125rem;
    }

    .markdown-content pre {
      background: var(--gray-100);
      padding: 0.875rem;
      border-radius: var(--border-radius);
      margin: 0.875rem 0;
      overflow-x: auto;
      border: 1px solid var(--gray-200);
    }

    .markdown-content code {
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      background: var(--gray-100);
      padding: 0.25rem 0.375rem;
      border-radius: var(--border-radius-sm);
      font-size: 0.875rem;
      color: var(--gray-800);
    }

    .markdown-content ul, .markdown-content ol {
      margin-left: 1.5rem;
      margin-top: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .markdown-content li {
      margin-bottom: 0.375rem;
    }

    /* Quick questions buttons */
    .quick-questions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.625rem;
      margin-bottom: 1rem;
    }

    .quick-question-btn {
      background: var(--primary-light);
      color: var(--primary);
      border: 1px solid var(--primary-light);
      border-radius: var(--border-radius-full);
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-fast);
      box-shadow: var(--box-shadow-sm);
    }

    .quick-question-btn:hover {
      background: var(--primary);
      color: var(--white);
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }

    .quick-question-btn:active {
      transform: scale(0.97);
    }
    
    /* Chat floating button */
    .chat-fab {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--box-shadow-lg);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
    }

    .chat-fab:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
    }

    .chat-fab i {
      font-size: 24px;
    }

    /* Custom scrollbar for modern browsers */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gray-300);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray-400);
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .sidebar-toggle {
        display: block;
      }
      
      #sidebar {
        position: absolute;
        height: 100%;
        transform: translateX(-100%);
        width: 85%;
        max-width: 350px;
        z-index: 10;
      }
      
      #sidebar.expanded {
        transform: translateX(0);
      }
      
      .strategy-cards {
        grid-template-columns: 1fr;
      }
      
      .message-wrapper {
        max-width: 85%;
      }

      .nav-tabs {
        gap: 0;
      }

      #navbar button {
        padding: 0.5rem 0.75rem;
      }

      #navbar button span {
        display: none;
      }

      #navbar button i {
        font-size: 1.125rem;
        margin: 0;
      }

      .chat-header h1 span {
        display: none;
      }

      #timelineContent, #strategyContent, #detailsContent {
        padding: 1.25rem;
      }
    }

    @media (max-width: 480px) {
      .message-wrapper {
        max-width: 95%;
      }

      .quick-questions {
        gap: 0.5rem;
      }

      .quick-question-btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Navigation bar for multi-view interface -->
    <div id="navbar">
      <div class="brand">
        <i class="fas fa-globe-asia"></i>
        <span>RIL Global Strategy</span>
      </div>
      <div class="nav-tabs">
        <button id="btn-map" class="active" onclick="switchView('view-map')">
          <i class="fas fa-map-marked-alt"></i> <span>Map</span>
        </button>
        <button id="btn-timeline" onclick="switchView('view-timeline')">
          <i class="fas fa-history"></i> <span>Timeline</span>
        </button>
        <button id="btn-strategy" onclick="switchView('view-strategy')">
          <i class="fas fa-chess"></i> <span>Strategy</span>
        </button>
        <button id="btn-details" onclick="switchView('view-details')">
          <i class="fas fa-file-alt"></i> <span>Details</span>
        </button>
        <button id="btn-chat" onclick="switchView('view-chat')">
          <i class="fas fa-robot"></i> <span>AI Assistant</span>
        </button>
      </div>
    </div>

    <!-- Main content container -->
    <div class="views-container">
      <!-- Map View -->
      <div id="view-map" class="view active">
        <div id="sidebar">
          <div class="sidebar-header">
            <h2><i class="fas fa-globe"></i> RIL Global Footprint</h2>
          </div>
          
          <!-- Filtering Controls -->
          <div class="filter-group">
            <div class="filter-title">
              <i class="fas fa-filter"></i> Entity Types
            </div>
            <div class="filter-option">
              <input type="checkbox" id="filter-operations" checked>
              <label for="filter-operations">Operations</label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="filter-partnerships" checked>
              <label for="filter-partnerships">Partnerships</label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="filter-opportunities" checked>
              <label for="filter-opportunities">Opportunities</label>
            </div>
          </div>
          
          <div class="filter-group">
            <div class="filter-title">
              <i class="fas fa-tasks"></i> Status Filter
            </div>
            <select id="filter-status">
              <option value="all" selected>All (current, past, future)</option>
              <option value="current">Current Only</option>
              <option value="past">Past Only</option>
              <option value="future">Future Opportunities</option>
            </select>
          </div>
          
          <div class="filter-group">
            <div class="filter-title">
              <i class="fas fa-calendar-alt"></i> Time Period
            </div>
            <div class="slider-container">
              <div class="slider-label">
                <span>Year:</span>
                <span class="time-value" id="timeLabel">2025</span>
              </div>
              <input type="range" id="time-slider" min="1990" max="2025" value="2025">
            </div>
          </div>
          
          <hr>
          
          <div class="marker-list-header">
            <h3>Locations</h3>
            <span class="marker-count" id="marker-count">0 shown</span>
          </div>
          <div id="markerList"></div>
        </div>
        <div class="sidebar-toggle" id="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </div>
        <div id="map"></div>
      </div>

      <!-- Timeline View -->
      <div id="view-timeline" class="view">
        <div id="timelineContent">
          <div class="timeline-header">
            <h2><i class="fas fa-history"></i> Timeline of RIL's International Presence</h2>
            <p>Explore Reliance Industries' evolution from a domestic textile player in the 1960s to a global energy conglomerate, with key milestones in international expansion and strategic partnerships.</p>
            <div class="timeline-info">
              <i class="fas fa-info-circle"></i> 
              <span>Timeline shows events in reverse chronological order (newest first). Use the slider to explore different time periods.</span>
            </div>
          </div>
          
          <div class="timeline-controls">
            <div class="filter-title">
              <i class="fas fa-calendar-alt"></i> Filter Timeline
            </div>
            <div class="slider-container">
              <div class="slider-label">
                <span>Year:</span>
                <span class="time-value" id="timelineTimeLabel">2025</span>
              </div>
              <input type="range" id="timeline-slider" min="1990" max="2025" value="2025">
            </div>
          </div>
          
          <div class="timeline" id="timelineList">
            <!-- Timeline items will be inserted here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Strategy View -->
      <div id="view-strategy" class="view">
        <div id="strategyContent">
          <div class="strategy-header">
            <h2><i class="fas fa-chess"></i> Strategic Insights & Recommendations</h2>
            <p>A comprehensive roadmap for RIL's international growth and development across different time horizons, based on historical performance, market selection criteria, and organizational considerations.</p>
          </div>
          
          <div class="strategy-cards">
            <div class="strategy-card short-term">
              <h3><i class="fas fa-bolt"></i> Short-Term (1–3 Years)</h3>
              <ul>
                <li>Focus on low-risk, high-synergy markets (e.g., strengthen presence in the Middle East).</li>
                <li>Optimize entry modes via strategic alliances (e.g., extend the BP partnership model).</li>
                <li>Create an International Operations Cell to streamline decision-making and expedite approvals.</li>
                <li>Engage stakeholders with targeted CSR initiatives in host communities and transparent ESG reporting.</li>
                <li>Build on existing ventures like the BP gas JV and new UAE chemical JV with ADNOC.</li>
              </ul>
            </div>
            
            <div class="strategy-card medium-term">
              <h3><i class="fas fa-chart-line"></i> Medium-Term (3–7 Years)</h3>
              <ul>
                <li>Selective upstream investments in politically stable, high-demand regions with focus on natural gas assets.</li>
                <li>Expand downstream and petrochemical capacities in key markets to secure supply chains.</li>
                <li>Establish regional hubs (e.g., Middle East & Africa hub in Dubai) with delegated authority.</li>
                <li>Increase local talent in leadership – aim for 30% local nationals in management of overseas ventures.</li>
                <li>Publish International Sustainability Report to address NGO and investor stakeholder demands.</li>
              </ul>
            </div>
            
            <div class="strategy-card long-term">
              <h3><i class="fas fa-rocket"></i> Long-Term (7+ Years)</h3>
              <ul>
                <li>Transition to a transnational model balancing global integration with local responsiveness.</li>
                <li>Build an integrated global network with digital twin operations centers to optimize flows.</li>
                <li>Consider establishing "Reliance International" as a separate holding for non-India energy assets.</li>
                <li>Deepen stakeholder trust through global sustainability partnerships and local engagement.</li>
                <li>Develop country-specific business units for new energy that adapt solutions to local markets.</li>
              </ul>
            </div>
          </div>
          
          <div class="details-section">
            <h3>Short-Term Implementation</h3>
            <p>In the immediate 1-3 year period, RIL should focus on strengthening its position in existing markets while carefully evaluating new opportunities. This includes consolidating and optimizing ventures like the BP gas JV, building stakeholder goodwill through strategic CSR initiatives, and evaluating partnerships in promising regions for renewables or LNG developments. For market selection, prioritize regions that complement existing operations, particularly the Middle East where political stability is reasonably high and feedstock is abundant.</p>
            
            <h3>Medium-Term Growth</h3>
            <p>During the 3-7 year horizon, RIL can selectively pursue upstream projects in stable regions, focusing on gas-rich but politically secure countries. Downstream expansions should target key markets to secure supply chains. The organization should also begin decentralizing decision-making by empowering regional hubs in trading and project management. Talent localization should be prioritized, with at least 30% of mid-to-senior management as local hires in international subsidiaries. This balanced approach will enable better regional strategy coherence and improved stakeholder relations.</p>
            
            <h3>Long-Term Vision</h3>
            <p>For the 7+ year perspective, RIL should pivot toward a transnational approach that balances global efficiencies with local adaptation, particularly in new energy businesses like green hydrogen and solar manufacturing. Establishing a separate international holding structure could provide better governance for overseas assets, while continually deepening stakeholder relationships across markets. The company should aim to have a balanced international portfolio, potentially re-entering high-potential markets once conditions improve, while divesting assets that no longer fit the strategic direction.</p>
          </div>
        </div>
      </div>

      <!-- Details View -->
      <div id="view-details" class="view">
        <div id="detailsContent">
          <h2><i class="fas fa-file-alt"></i> In-Depth Analysis of RIL's Global Strategy</h2>
          
          <div class="details-section">
            <h3>Historical Evolution</h3>
            <p>RIL's journey from a domestic textile player to a global energy conglomerate is marked by bold international forays, key strategic partnerships, and evolving entry modes. Initially expanding aggressively through overseas asset acquisitions and joint ventures – including landmark initiatives like the BP gas marketing partnership in 2011 (BP acquired 30% stake in RIL's 23 oil and gas production-sharing contracts for $7.2 billion) – RIL learned that centralization ensured strategic coherence while limiting local responsiveness.</p>
            
            <p>Over time, RIL recalibrated its approach by consolidating ventures, adopting asset-light strategies, and increasingly relying on partnerships to mitigate risk. Its evolution from aggressive expansion toward a more measured, transnational strategy reflects lessons learned from operating in diverse regulatory, geopolitical, and market environments. By 2016-17, RIL had divested or relinquished almost all international blocks outside India, retaining only two gas blocks in Myanmar, signaling a strategic pivot back to domestic projects and new businesses.</p>
          </div>
          
          <div class="details-section">
            <h3>Global vs. Local Strategy</h3>
            <p>RIL's international approach aligns with a global/international strategy on the Integration-Responsiveness grid. The company emphasizes centralized scale and efficiency (e.g., exporting refined fuels globally from India) over local adaptation. It partners with foreign firms for technology and market access rather than deeply customizing products per country. RIL leverages the same strengths developed at home (technical know-how, project execution, capital) and applies them abroad.</p>
            
            <p>This approach yields cost advantages and consistent quality but can limit local responsiveness. Notably, RIL's upstream ventures abroad were managed via its Dubai subsidiary, indicating central control with modest local autonomy. It is only in very recent years, with moves into consumer-facing sectors and renewable energy, that RIL's thinking has started to incorporate more transnational elements that balance global efficiencies with local market adaptation.</p>
          </div>
          
          <div class="details-section">
            <h3>Foreign Market Selection</h3>
            <p>RIL prioritized foreign markets rich in natural resources or strategic value. It acquired oil & gas assets in resource-abundant countries like Yemen, Oman, Peru, Kurdistan (Iraq), East Timor, Australia, and the United States. Market selection criteria included hydrocarbon potential (e.g., shale gas boom in the U.S.), geopolitical considerations (e.g., entering Myanmar in 2014 amid opening economy), and partnership opportunities (e.g., aligning with BP in India, proposed Saudi Aramco deal).</p>
            
            <p>However, political and regulatory risks posed significant challenges—Yemen's civil instability and contractual disputes in Kurdistan led to exits. Successes were limited; many overseas exploration projects did not reach production, and U.S. shale investments faced profitability issues with falling gas prices. RIL showed a moderate risk appetite: willing to venture into Yemen or Iraq's Kurdistan for big oil opportunities, but also willing to exit when risks outweighed rewards. The pattern suggests RIL did not shy away from distant markets if the prize was right, but its ultimate success rate was higher in markets where the environment was stable.</p>
          </div>
          
          <div class="details-section">
            <h3>Entry Modes</h3>
            <p>RIL utilized joint ventures, acquisitions, and wholly-owned subsidiaries as entry modes. It set up wholly-owned subsidiaries (e.g., Reliance E&P DMCC in Dubai) to bid on international blocks. It entered joint ventures with local operators in U.S. shale to leverage partner expertise: 40% stake with Atlas Energy in Marcellus Shale for $1.7 billion, 45% with Pioneer in Eagle Ford Shale for $1.35 billion, and 60% with Carrizo Oil & Gas for ~$392 million.</p>
            
            <p>These modes were chosen to manage risk and gain know-how—JVs gave RIL technical expertise and spread capital costs, while acquisitions offered instant global scale. The effectiveness was mixed: JVs helped RIL learn (e.g., advanced shale drilling techniques) but also led to write-downs when market conditions changed, whereas the attempted LyondellBasell acquisition in 2009-10 failed amid the target's financial issues. The combination of entry modes complemented each other—JVs for learning, wholly-owned subsidiaries for control/trade, exports for immediate market penetration, and attempted M&A for quantum leaps.</p>
          </div>
          
          <div class="details-section">
            <h3>Organizational Structure</h3>
            <p>RIL's international operations are highly centralized. Key decisions and strategy originate from headquarters in Mumbai, with overseas arms executing rather than strategizing. For example, its Singapore trading subsidiary had limited autonomy ("no real trading authority" was given to local staff) leading to the team's exit. The company manages global trading through Mumbai and maintains foreign subsidiaries in hubs like London, Singapore, and Dubai for presence.</p>
            
            <p>This centralized structure ensures strategic alignment and control over finances but poses challenges in agility and local market responsiveness. The departure of the Singapore trading team in 2009 illustrates how even day-to-day decisions required Mumbai's nod, a highly centralized approach. The benefit of such centralization is strategic coherence and risk control, but local agility can suffer. In dynamic markets, waiting for Mumbai to approve can slow down responses, and there's risk of headquarters being distant from on-ground realities.</p>
          </div>
          
          <div class="details-section">
            <h3>Stakeholder Management</h3>
            <p>RIL engages proactively with governments and regulators in foreign markets, recognizing political capital as key in energy. It often partners with state-owned firms (e.g., talks with ONGC Videsh for joint bidding) to align with host government interests. Culturally, RIL adapts by hiring local experts or partnering with local companies in sensitive regions.</p>
            
            <p>However, its stakeholder approach has sometimes been reactive—for instance, continuing oil trade with sanctioned Russia in 2022 drew NGO criticism, indicating a focus on business over reputational risk until external pressure mounts. In community and NGO relations, RIL's CSR abroad has been less public; its major CSR efforts (healthcare, education, disaster relief) are concentrated in India. RIL tends to be proactive with governments and customers, but more reactive with NGOs and communities. This is an area flagged for improvement as global standards for Environmental, Social, and Governance (ESG) rise.</p>
          </div>
        </div>
      </div>

      <!-- Chat View -->
      <div id="view-chat" class="view">
        <div class="chat-container">
          <div class="chat-header">
            <h1><i class="fas fa-robot"></i> <span>RIL Strategy Assistant</span></h1>
            <div class="chat-actions">
              <button class="action-button" id="clear-chat" title="Clear chat history">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
          
          <div class="messages-container" id="messages">
            <!-- Messages will be inserted here -->
          </div>
          
          <div class="chat-input-container">
            <div class="quick-questions">
              <button class="quick-question-btn" data-question="What is RIL's strategy in the Middle East?">Middle East Strategy</button>
              <button class="quick-question-btn" data-question="How did RIL's international strategy evolve over time?">Strategy Evolution</button>
              <button class="quick-question-btn" data-question="What entry modes did RIL use internationally?">Entry Modes</button>
              <button class="quick-question-btn" data-question="Explain RIL's organizational structure overseas">Org Structure</button>
              <button class="quick-question-btn" data-question="Show me key markets on the map">Key Markets</button>
            </div>
            <div class="chat-input-row">
              <textarea 
                id="user-input" 
                class="chat-input" 
                placeholder="Ask about RIL's global strategy..." 
                rows="1"
                maxlength="1000"></textarea>
              <button id="send-button" class="send-button" disabled>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal for Detailed Information Card -->
      <div id="detailModal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="modalTitle">Location Details</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
          </div>
          <div class="modal-body" id="modalContent">
            <!-- Content will be populated by JavaScript -->
          </div>
          <div class="modal-footer">
            <button onclick="closeModal()">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating chat button (visible in all views except chat) -->
    <div class="chat-fab" id="chat-fab" onclick="switchView('view-chat')">
      <i class="fas fa-comment-dots"></i>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
  <script>
    // Enhanced marker data with additional historical context from document
    const markersData = [
      {name: "Mumbai, India (HQ)", coords: [19.0760, 72.8777], type: "operation", status: "current", year: 1990, description: "Mumbai HQ – the nerve center for strategic global integration with centralized decision-making, coordinating all international ventures. RIL's leadership maintains tight control over foreign operations from this headquarters."},
      {name: "Jamnagar Refinery, India", coords: [22.4707, 70.0577], type: "operation", status: "current", year: 1990, description: "World's largest refining hub and a major export powerhouse, producing fuels and petrochemicals for global markets with advanced technology. Jamnagar represents 7% of India's total merchandise exports, reflecting RIL's global integration strategy."},
      {name: "Dubai, UAE", coords: [25.2048, 55.2708], type: "operation", status: "current", year: 2007, description: "Reliance E&P DMCC – established in 2007 as a dedicated hub for international exploration that oversees global upstream investments with a focus on strategic partnerships. This entity was created specifically to hold and manage overseas exploration licenses."},
      {name: "Singapore Trading Hub", coords: [1.3521, 103.8198], type: "operation", status: "current", year: 2008, description: "Key international trading operations handling refined products and petrochemicals for Asian markets, though with limited local autonomy. The entire Singapore trading desk once quit due to lack of empowerment, highlighting challenges in RIL's centralized decision-making."},
      {name: "London Trading Hub, UK", coords: [51.5074, -0.1278], type: "operation", status: "current", year: 2008, description: "Global energy trading center focusing on European and Atlantic basin markets, working in coordination with Mumbai HQ for strategic decisions. Established in 2008 to tap global markets and improve arbitrage trading of refined fuels."},
      {name: "Marcellus Shale, USA (Pennsylvania)", coords: [41.2033, -77.1945], type: "operation", status: "past", year: 2010, description: "U.S. shale gas JV with Atlas Energy (40% stake, $1.7B investment) acquired in 2010. This venture, now in the past, was part of RIL's aggressive push into the U.S. shale gas boom but faced challenges due to market volatility and falling gas prices."},
      {name: "Eagle Ford Shale, USA (Texas)", coords: [29.7604, -95.3698], type: "operation", status: "past", year: 2010, description: "U.S. shale gas JV with Pioneer Natural Resources (45% stake, $1.35B) acquired in 2010. Operations were phased out when gas prices fell and profitability declined. Initially part of RIL's strategic aim to become 'one of the key five to six companies in the shale business.'"},
      {name: "Yemen Oil Block", coords: [15.5527, 48.5164], type: "operation", status: "past", year: 2007, description: "Former oil block acquired in 2007 with production halted by conflict. Initially promising with some production success before civil unrest forced exit. RIL sold its stake by 2012 when Yemen's political instability grew, highlighting political risk in market selection."},
      {name: "Oman Oil Blocks", coords: [21.4735, 55.9754], type: "operation", status: "past", year: 2007, description: "Acquired blocks in a resource‐rich region with modest yields but eventually relinquished due to limited commercial success despite political stability. Part of RIL's Middle East strategy to establish a foothold near the world's energy hub."},
      {name: "Peru Exploration Blocks", coords: [-9.189967, -75.015152], type: "operation", status: "past", year: 2007, description: "Latin American exploration blocks acquired for potential gains in the Amazon basin, but exited by 2017 without major discoveries. RIL had acquired stakes in four blocks in Peru, attracted by its investor-friendly policies and under-explored basins."},
      {name: "Kurdistan, Iraq", coords: [36.1911, 44.0092], type: "operation", status: "past", year: 2007, description: "Exploration block marked by significant geopolitical challenges including disputes between regional and central governments, leading to eventual exit. RIL's move into Kurdistan in 2007-08 was alongside other independent oil firms during an oil rush there."},
      {name: "Myanmar Offshore Blocks", coords: [21.9162, 95.9560], type: "operation", status: "current", year: 2014, description: "Offshore gas blocks acquired during Myanmar's reform phase in 2014, representing RIL's last major international exploration investment before strategic pivot. Myanmar was opening to foreign investment post-2011 reforms, making it an attractive frontier market."},
      {name: "East Timor Block", coords: [-8.8742, 125.7275], type: "operation", status: "past", year: 2007, description: "Offshore block in a nascent market with high potential that was later dropped due to regulatory uncertainties and boundary disputes. East Timor was a new nation with political risk but large gas fields – RIL likely aimed to get in early."},
      {name: "Australian Exploration Block", coords: [-25.2744, 133.7751], type: "operation", status: "past", year: 2007, description: "Exploration block in offshore gas prospects that was part of RIL's aggressive international expansion phase but yielded limited results. This block, along with East Timor, was chosen for offshore gas prospects in the Timor Sea region."},
      {name: "BP Partnership (UK)", coords: [51.515, -0.12], type: "partnership", status: "current", year: 2011, description: "Strategic 50:50 joint venture with BP for gas marketing in India, following BP's $7.2B investment for 30% stake in RIL's 23 Indian oil & gas blocks. This 2011 partnership was a watershed moment, bringing in technology and affirming RIL's willingness to collaborate internationally."},
      {name: "UAE Chemical JV (ADNOC)", coords: [24.4539, 54.3773], type: "partnership", status: "current", year: 2021, description: "Joint venture with Abu Dhabi National Oil Company (ADNOC) for chemical projects at the TA'ZIZ Industrial Complex in Ruwais. This recent partnership exemplifies RIL's continued focus on the Middle East as a key strategic region."},
      {name: "Nigeria Opportunity", coords: [6.5244, 3.3792], type: "opportunity", status: "future", year: 2023, description: "Emerging market with promising downstream opportunities in refining and petrochemicals, aligned with Nigeria's need for domestic processing capacity. If governance improves, Nigeria could be a market where RIL's downstream prowess fits well."},
      {name: "Mozambique LNG Opportunity", coords: [-18.6657, 35.5296], type: "opportunity", status: "future", year: 2024, description: "Potential investment in East African LNG development, representing a strategic opportunity to secure gas resources in a politically stabilizing region. Natural gas projects align with energy transition as gas is seen as a bridge fuel."}
    ];

    // Additional data for Timeline view
    const additionalTimelineEvents = [
      {name: "Global Depository Receipt", coords: [19.0760, 72.8777], type: "milestone", status: "past", year: 1993, description: "RIL issued a Global Depository Receipt, becoming one of the first Indian firms to raise equity abroad. This early step signaled an ambition to integrate with global finance and laid groundwork for international growth."},
      {name: "LyondellBasell Acquisition Attempt", coords: [51.5074, -0.1278], type: "milestone", status: "past", year: 2009, description: "RIL attempted to acquire LyondellBasell, a Netherlands-based petrochemical giant emerging from bankruptcy. Though the deal (valued between $6-14 billion) ultimately fell through, it signaled RIL's intent to take a bold global step."},
      {name: "Divestment of International E&P Assets", coords: [19.0760, 72.8777], type: "milestone", status: "past", year: 2016, description: "By 2016-17, RIL had divested or relinquished almost all international blocks outside India, retaining only two gas blocks in Myanmar. This marked a strategic re-calibration to focus on domestic projects and new businesses."},
      {name: "Saudi Aramco O2C Deal Proposed", coords: [19.0760, 72.8777], type: "milestone", status: "past", year: 2019, description: "RIL announced a potential 20% stake sale of its Oil-to-Chemicals (O2C) division to Saudi Aramco. Though put on hold in 2021 due to valuation changes and energy transition priorities, it represented a significant potential partnership."}
    ];

    // Global variables for Leaflet layers and marker objects storage
    let map, markersLayer, connectionsLayer, legend;
    let markerObjects = []; // to store each marker along with its data
    let sidebarExpanded = true;
    
    // Combine all data for full timeline view
    const allTimelineData = [...markersData, ...additionalTimelineEvents];

    // Initialize the Leaflet map (for Map View)
    function initMap() {
      map = L.map('map', {
        zoomControl: false,
        attributionControl: false
      }).setView([20, 0], 2);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      
      // Add zoom control in a better position
      L.control.zoom({
        position: 'bottomright'
      }).addTo(map);
      
      // Add attribution in a better position
      L.control.attribution({
        position: 'bottomleft'
      }).addTo(map);
      
      markersLayer = L.layerGroup().addTo(map);
      connectionsLayer = L.layerGroup().addTo(map);
      
      // Add legend
      createLegend();
      
      // Handle sidebar toggle
      document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
    }
    
    // Toggle sidebar visibility (for mobile)
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('sidebar-toggle');
      
      sidebarExpanded = !sidebarExpanded;
      sidebar.classList.toggle('expanded', sidebarExpanded);
      
      // Update the icon
      toggle.innerHTML = sidebarExpanded ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
      
      // Update map size after the toggle animation completes
      setTimeout(() => {
        map.invalidateSize();
      }, 300);
    }
    
    // Create map legend
    function createLegend() {
      legend = L.control({position: 'bottomright'});
      
      legend.onAdd = function (map) {
        const div = L.DomUtil.create('div', 'legend');
        div.innerHTML = `
          <h4>Legend</h4>
          <div><i style="background:#3B82F6"></i> Current Operations</div>
          <div><i style="background:#9CA3AF"></i> Past Operations</div>
          <div><i style="background:#DB2777"></i> Partnerships</div>
          <div><i style="background:#10B981"></i> Future Opportunities</div>
          <div><i style="background:#EF4444; opacity:0.6"></i> Strategic Connections</div>
        `;
        return div;
      };
      
      legend.addTo(map);
    }

    // Define custom marker icons based on type and status
    function getMarkerIcon(data) {
      let iconUrl, color;
      
      if (data.type === "operation") {
        if (data.status === "current") {
          color = "#3B82F6"; // blue
          iconUrl = "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png";
        } else {
          color = "#9CA3AF"; // gray
          iconUrl = "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png";
        }
      } else if (data.type === "partnership") {
        color = "#DB2777"; // pink
        iconUrl = "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png";
      } else if (data.type === "opportunity") {
        color = "#10B981"; // green
        iconUrl = "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png";
      } else if (data.type === "milestone") {
        color = "#F59E0B"; // orange/amber
        iconUrl = "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-gold.png";
      }

      return L.icon({
        iconUrl: iconUrl,
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/images/marker-shadow.png',
        iconSize: [25, 41], 
        iconAnchor: [12, 41], 
        popupAnchor: [1, -34], 
        shadowSize: [41, 41]
      });
    }

    // Create marker objects from markersData and store in markerObjects array
    function createMarkers() {
      markerObjects = []; // clear any existing
      markersData.forEach(data => {
        const marker = L.marker(data.coords, {
          icon: getMarkerIcon(data),
          riseOnHover: true
        });
        
        // Enhanced popup with more information
        const popupContent = `
          <div style="font-family: 'Inter', sans-serif; padding: 5px;">
            <h4 style="margin: 0 0 5px; color: #0047AB;">${data.name}</h4>
            <div style="margin-bottom: 5px;">
              <span style="font-weight: 500; color: #6B7280;">Established:</span> ${data.year}
            </div>
            <div style="margin-bottom: 5px;">
              <span style="font-weight: 500; color: #6B7280;">Type:</span> ${data.type.charAt(0).toUpperCase() + data.type.slice(1)}
            </div>
            <div>
              <span style="font-weight: 500; color: #6B7280;">Status:</span> ${data.status.charAt(0).toUpperCase() + data.status.slice(1)}
            </div>
          </div>
        `;
        
        marker.bindPopup(popupContent);
        
        // Full details on click
        marker.on('click', () => showDetailCard(data));
        
        markerObjects.push({data: data, marker: marker});
      });
    }

    // Update markers on the map based on filter settings
    function updateMarkers() {
      markersLayer.clearLayers();
      connectionsLayer.clearLayers();
      document.getElementById("markerList").innerHTML = "";
      
      let visibleCount = 0;

      // Get filter values
      const showOps = document.getElementById("filter-operations").checked;
      const showParts = document.getElementById("filter-partnerships").checked;
      const showOpps = document.getElementById("filter-opportunities").checked;
      const statusFilter = document.getElementById("filter-status").value;
      const selectedYear = parseInt(document.getElementById("time-slider").value);

      // Mumbai HQ coordinates for drawing connections
      const mumbaiCoords = [19.0760, 72.8777];

      markerObjects.forEach(obj => {
        const d = obj.data;
        // Filter by entity type
        let typeAllowed = false;
        if(d.type === "operation" && showOps) typeAllowed = true;
        if(d.type === "partnership" && showParts) typeAllowed = true;
        if(d.type === "opportunity" && showOpps) typeAllowed = true;
        
        // Filter by status
        let statusAllowed = false;
        if(statusFilter === "all") statusAllowed = true;
        else if(statusFilter === d.status) statusAllowed = true;
        
        // Filter by time (only show markers established on or before the selected year)
        let timeAllowed = (d.year <= selectedYear);

        if(typeAllowed && statusAllowed && timeAllowed) {
          markersLayer.addLayer(obj.marker);
          visibleCount++;
          
          // Add marker to sidebar list
          addMarkerToList(d, obj.marker);
          
          // If marker is not Mumbai HQ, draw a connection line
          if(d.type === "partnership" || d.type === "opportunity") {
            // Pink/red line for partnerships, green for opportunities
            const color = d.type === "partnership" ? "#DB2777" : "#10B981";
            const line = L.polyline([mumbaiCoords, d.coords], {
              color: color,
              dashArray: '5, 8',
              weight: 2.5,
              opacity: 0.7,
              smoothFactor: 1
            });
            connectionsLayer.addLayer(line);
          } else if(d.name !== "Mumbai, India (HQ)" && d.name !== "Jamnagar Refinery, India") {
            // Blue solid line for current operations, gray for past
            const color = d.status === 'current' ? "#3B82F6" : "#9CA3AF";
            const line = L.polyline([mumbaiCoords, d.coords], {
              color: color,
              weight: 1.5,
              opacity: 0.4,
              smoothFactor: 1
            });
            connectionsLayer.addLayer(line);
          }
        }
      });
      
      // Update marker count
      document.getElementById("marker-count").textContent = `${visibleCount} shown`;
    }

    // Update sidebar marker list for Map View
    function addMarkerToList(data, marker) {
      const markerListDiv = document.getElementById("markerList");
      const item = document.createElement("div");
      item.className = "marker-item";
      
      // Determine badge classes based on type and status
      const typeClass = `type-badge ${data.type}`;
      const statusClass = `type-badge ${data.status}`;
      
      item.innerHTML = `
        <div class="title">
          ${data.name}
          <span class="year">${data.year}</span>
        </div>
        <div class="marker-badges">
          <span class="${typeClass}">${data.type.charAt(0).toUpperCase() + data.type.slice(1)}</span>
          <span class="${statusClass}">${data.status.charAt(0).toUpperCase() + data.status.slice(1)}</span>
        </div>
        <div class="description">${data.description.substring(0, 120)}${data.description.length > 120 ? '...' : ''}</div>
      `;
      
      item.onclick = function() {
        map.setView(data.coords, 6);
        marker.openPopup();
        showDetailCard(data);
      };
      
      markerListDiv.appendChild(item);
    }

    // Update Timeline View: list events that are active based on the timeline slider
    function updateTimeline() {
      const timelineListDiv = document.getElementById("timelineList");
      timelineListDiv.innerHTML = "";
      const selectedYear = parseInt(document.getElementById("timeline-slider").value);
      document.getElementById("timelineTimeLabel").innerText = selectedYear;
      
      // Sort by year in reverse order (newest first)
      const sortedData = [...allTimelineData]
        .filter(d => d.year <= selectedYear)
        .sort((a, b) => b.year - a.year);
      
      // Create a "New" badge for recent entries
      const createNewBadge = (year) => {
        const isRecent = year >= selectedYear - 3;
        return isRecent ? `<span class="type-badge" style="background: #FEF2F2; color: #EF4444;">New</span>` : '';
      };
      
      sortedData.forEach(d => {
        const item = document.createElement("div");
        item.className = "timeline-item";
        
        // Determine badges
        const typeClass = `type-badge ${d.type}`;
        const statusClass = `type-badge ${d.status}`;
        const newBadge = createNewBadge(d.year);
        
        item.innerHTML = `
          <span class="year">${d.year}</span>
          <h3>${d.name}</h3>
          <div class="timeline-badges">
            ${newBadge}
            <span class="${typeClass}">${d.type.charAt(0).toUpperCase() + d.type.slice(1)}</span>
            <span class="${statusClass}">${d.status.charAt(0).toUpperCase() + d.status.slice(1)}</span>
          </div>
          <p>${d.description}</p>
        `;
        
        // Add animation class for new entries that appear when sliding
        if (d.year === selectedYear) {
          item.classList.add('new-entry');
          setTimeout(() => item.classList.remove('new-entry'), 1000);
        }
        
        timelineListDiv.appendChild(item);
      });
      
      // If no events yet for the selected year
      if (sortedData.length === 0) {
        const placeholder = document.createElement('div');
        placeholder.className = 'timeline-placeholder';
        placeholder.innerHTML = `<p>No international events recorded yet for ${selectedYear}.</p>`;
        timelineListDiv.appendChild(placeholder);
      }
    }

    // Switch between different views with enhanced transitions
    function switchView(viewId) {
      // Add fade out effect to current active view
      const currentView = document.querySelector('.view.active');
      if (currentView) {
        currentView.style.opacity = '0';
        setTimeout(() => {
          // Then switch the actual views
          document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
          document.getElementById(viewId).classList.add("active");
          
          // Fade in the new view
          setTimeout(() => {
            document.getElementById(viewId).style.opacity = '1';
          }, 50);
        }, 300);
      } else {
        // If no current view (first load), just switch
        document.getElementById(viewId).classList.add("active");
        document.getElementById(viewId).style.opacity = '1';
      }
      
      // Update navbar button active state
      document.querySelectorAll("#navbar button").forEach(btn => btn.classList.remove("active"));
      document.getElementById("btn-" + viewId.split('-')[1]).classList.add("active");
      
      // Toggle floating chat button visibility
      document.getElementById('chat-fab').style.display = (viewId === 'view-chat') ? 'none' : 'flex';
      
      // If switching to Map View, invalidate map size
      if(viewId === "view-map") {
        setTimeout(() => { map.invalidateSize(); }, 350);
      }
    }

    // Show a detailed information card in a modal when a marker is clicked
    function showDetailCard(data) {
      const modal = document.getElementById("detailModal");
      const modalContent = document.getElementById("modalContent");
      const modalTitle = document.getElementById("modalTitle");
      
      modalTitle.textContent = data.name;
      
      // Create badges for type and status
      const typeClass = `type-badge ${data.type}`;
      const statusClass = `type-badge ${data.status}`;
      
      modalContent.innerHTML = `
        <div class="detail-item">
          <span class="label">Established:</span> ${data.year}
        </div>
        <div class="detail-item">
          <span class="label">Type:</span> 
          <div class="detail-badges">
            <span class="${typeClass}">${data.type.charAt(0).toUpperCase() + data.type.slice(1)}</span>
          </div>
        </div>
        <div class="detail-item">
          <span class="label">Status:</span> 
          <div class="detail-badges">
            <span class="${statusClass}">${data.status.charAt(0).toUpperCase() + data.status.slice(1)}</span>
          </div>
        </div>
        <div class="detail-item">
          <p>${data.description}</p>
        </div>
      `;
      
      modal.style.display = "flex";
      setTimeout(() => {
        modal.classList.add("show");
      }, 10);
    }
    
    function closeModal() {
      const modal = document.getElementById("detailModal");
      modal.classList.remove("show");
      setTimeout(() => {
        modal.style.display = "none";
      }, 400); // Match the transition duration
    }

    // --- CHATBOT FUNCTIONALITY --- //
    
    // Enhanced configuration for the chatbot with more details from document
    const CHATBOT_CONFIG = {
      API_KEY: 'AIzaSyA8R_U1pHmh78Qs3q1PWbAJF_qTgsDFGBc',
      API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
      STORAGE_KEY: 'ril_chat_history',
      SYSTEM_CONTEXT: `You are an AI assistant specialized in Reliance Industries Limited's (RIL) global strategy. 
      
      You have deep knowledge of RIL's international operations, market selection, entry modes, organizational structure, 
      and stakeholder management approaches. You can provide insights about RIL's historical evolution from a textile 
      company to a global energy conglomerate through the 2000s.
      
      Key facts about RIL's international strategy:
      
      - Historical Evolution: RIL began international expansion in the 1990s (GDR in 1993), established Reliance E&P DMCC in Dubai in 2007 to acquire overseas oil/gas blocks, formed a major partnership with BP in 2011 (BP bought 30% of RIL's Indian oil & gas blocks for $7.2 billion), and made aggressive investments in U.S. shale gas in 2010. By the late 2010s, RIL had exited most international upstream assets.
      
      - Global Strategy: RIL follows a global/international strategy with centralized scale and efficiency over local adaptation. Its approach is characterized by centralized decision-making from Mumbai HQ.
      
      - Market Selection: RIL targeted resource-rich countries like Yemen, Oman, Peru, Kurdistan (Iraq), East Timor, Australia, and the United States. Market selection criteria included hydrocarbon potential, geopolitical stability, and partnership opportunities.
      
      - Entry Modes: RIL used joint ventures (e.g., U.S. shale deals with Atlas Energy, Pioneer, and Carrizo), wholly-owned subsidiaries (e.g., Dubai E&P DMCC, trading arms in London and Singapore), and attempted acquisitions (LyondellBasell bid in 2009).
      
      - Organizational Structure: RIL's operations are highly centralized, with key decisions made in Mumbai. Foreign subsidiaries like trading desks had limited autonomy, leading to challenges (e.g., Singapore trading team quitting due to lack of empowerment).
      
      - Stakeholder Management: RIL engages proactively with governments but has been more reactive with NGOs and communities. Its CSR abroad has been less public than its domestic initiatives.
      
      - Recommendations: RIL should focus on low-risk, high-synergy markets in the short term, selectively expand in stable regions in the medium term, and transition to a transnational approach in the long term.
      
      When asked about RIL's strategy, draw from this knowledge to provide concise, accurate responses.
      If the user asks to "show" something on the map, interpret this as a request to focus the map on specific 
      locations and respond with guidance about what they should look for.`
    };
    
    // State
    let isWaitingForResponse = false;
    let chatHistory = [];
    
    function getCurrentTimestamp() {
      const now = new Date();
      return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    function displayWelcomeMessage() {
      if (chatHistory.length === 0) {
        const welcomeMessage = {
          type: 'bot',
          text: `Welcome to the RIL Strategy Assistant! I'm here to help you understand Reliance Industries' global strategy and international operations. You can ask about:

1. RIL's evolution from a domestic textile company to a global energy conglomerate
2. Market selection strategies across the Middle East, U.S., and other regions
3. Entry modes like joint ventures, acquisitions, and wholly-owned subsidiaries
4. Organizational structure of international operations and decision-making
5. Stakeholder management with governments, partners, and communities

How can I assist you with understanding RIL's global strategy today?`,
          timestamp: getCurrentTimestamp()
        };
        addMessageToUI(welcomeMessage);
        chatHistory.push(welcomeMessage);
        saveChatHistory();
      }
    }
    
    function addMessageToUI(message) {
      const messagesContainer = document.getElementById('messages');
      
      if (message.type === 'system') {
        const systemMessage = document.createElement('div');
        systemMessage.classList.add('system-message');
        if (message.isError) systemMessage.classList.add('error-message');
        systemMessage.textContent = message.text;
        messagesContainer.appendChild(systemMessage);
        return;
      }
      
      const messageWrapper = document.createElement('div');
      messageWrapper.classList.add('message-wrapper', `${message.type}-message`);
      
      // Add sender label for clarity
      const senderDiv = document.createElement('div');
      senderDiv.classList.add('message-sender');
      senderDiv.textContent = message.type === 'bot' ? 'RIL Assistant' : 'You';
      messageWrapper.appendChild(senderDiv);
      
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');
      
      if (message.type === 'bot') {
        // Process markdown for bot messages
        messageDiv.classList.add('markdown-content');
        messageDiv.innerHTML = processMarkdown(message.text);
      } else {
        messageDiv.textContent = message.text;
      }
      
      const timestampDiv = document.createElement('div');
      timestampDiv.classList.add('timestamp');
      timestampDiv.textContent = message.timestamp;
      
      messageWrapper.appendChild(messageDiv);
      messageWrapper.appendChild(timestampDiv);
      messagesContainer.appendChild(messageWrapper);
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function showTypingIndicator() {
      const messagesContainer = document.getElementById('messages');
      const typingIndicator = document.createElement('div');
      typingIndicator.id = 'typing-indicator';
      typingIndicator.classList.add('typing-indicator');
      
      typingIndicator.innerHTML = `
        <span></span>
        <span></span>
        <span></span>
      `;
      
      messagesContainer.appendChild(typingIndicator);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function removeTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }
    
    // Enhanced markdown processor
    function processMarkdown(text) {
      // This is a basic implementation - for production use a proper markdown library
      let processed = text
        // Bold
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // Italic
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        // Headers
        .replace(/^### (.*?)$/gm, '<h3>$1</h3>')
        .replace(/^## (.*?)$/gm, '<h2>$1</h2>')
        .replace(/^# (.*?)$/gm, '<h1>$1</h1>')
        // Code blocks
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        // Inline code
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        // Lists (improved)
        .replace(/^\- (.*?)$/gm, '<li>$1</li>')
        .replace(/^\d+\. (.*?)$/gm, '<li>$1</li>')
        .replace(/(<li>.*?<\/li>)+/gs, function(match) {
          if (match.includes('1. ') || /\d+\./g.test(match)) {
            return '<ol>' + match + '</ol>';
          } else {
            return '<ul>' + match + '</ul>';
          }
        })
        // Line breaks
        .replace(/\n/g, '<br>');
        
      return processed;
    }
    
    // Handle map navigation requests from the chat with enhanced features
    function handleMapNavigationRequest(message) {
      // Simple parsing of location requests
      const lowerMessage = message.toLowerCase();
      
      // Show specific location types
      if (lowerMessage.includes("show operations") || lowerMessage.includes("show me operations")) {
        switchView('view-map');
        document.getElementById("filter-operations").checked = true;
        document.getElementById("filter-partnerships").checked = false;
        document.getElementById("filter-opportunities").checked = false;
        updateMarkers();
        return "I've switched to the map view and filtered to show only operations. You can see RIL's operational locations marked with blue (current) and gray (past) markers. Note how RIL had operations in diverse regions including the Middle East, U.S. shale, and Southeast Asia, before consolidating its international presence.";
      }
      
      if (lowerMessage.includes("show partnerships") || lowerMessage.includes("show me partnerships")) {
        switchView('view-map');
        document.getElementById("filter-operations").checked = false;
        document.getElementById("filter-partnerships").checked = true;
        document.getElementById("filter-opportunities").checked = false;
        updateMarkers();
        return "I've switched to the map view and filtered to show only partnerships. These are marked with pink markers. Note RIL's strategic partnerships with BP in the UK (2011) and more recently with ADNOC in UAE (2021), reflecting its shift toward collaborative entry modes to share risk and gain expertise.";
      }
      
      if (lowerMessage.includes("show opportunities") || lowerMessage.includes("show me opportunities")) {
        switchView('view-map');
        document.getElementById("filter-operations").checked = false;
        document.getElementById("filter-partnerships").checked = false;
        document.getElementById("filter-opportunities").checked = true;
        updateMarkers();
        return "I've switched to the map view and filtered to show future opportunities. These are marked with green markers on the map. RIL is considering opportunities in markets like Nigeria (downstream potential) and Mozambique (LNG projects), which align with its evolved market selection criteria focusing on political stability and strategic fit.";
      }
      
      if (lowerMessage.includes("show markets") || lowerMessage.includes("show me markets") || lowerMessage.includes("key markets")) {
        switchView('view-map');
        document.getElementById("filter-operations").checked = true;
        document.getElementById("filter-partnerships").checked = true;
        document.getElementById("filter-opportunities").checked = true;
        updateMarkers();
        return "I've switched to the map view showing all of RIL's international markets. You can see how RIL's global presence evolved from aggressive expansion in the 2000s (with operations in Yemen, Oman, Peru, Kurdistan, etc.) to a more selective approach with key partnerships (BP, ADNOC) and strategic trading hubs (London, Singapore, Dubai). The connections to Mumbai HQ highlight RIL's centralized decision-making structure.";
      }
      
      // Check for specific regions
      if (lowerMessage.includes("middle east") || lowerMessage.includes("gulf")) {
        switchView('view-map');
        map.setView([25, 55], 5);
        return "I've focused the map on the Middle East region, which has been critical to RIL's international strategy. Here you can see operations in Dubai (E&P DMCC established in 2007), past ventures in Yemen and Oman, and the new chemical JV with ADNOC in UAE. The Middle East remains a priority for RIL in its short-term strategy recommendations due to political stability and resource availability.";
      }
      
      if (lowerMessage.includes("asia") || lowerMessage.includes("southeast asia")) {
        switchView('view-map');
        map.setView([10, 105], 4);
        return "I've focused the map on Southeast Asia, highlighting RIL's presence in Singapore (trading hub established in 2008) and Myanmar (offshore gas blocks acquired in 2014 during Myanmar's reform phase). The Singapore trading subsidiary faced challenges due to RIL's centralized decision-making, with the entire team once quitting due to lack of empowerment—illustrating organizational structure issues.";
      }
      
      if (lowerMessage.includes("united states") || lowerMessage.includes("us") || lowerMessage.includes("usa") || lowerMessage.includes("america")) {
        switchView('view-map');
        map.setView([40, -95], 4);
        return "I've focused the map on the United States, where RIL had significant shale gas investments in 2010-2011. RIL entered three joint ventures: with Atlas Energy in Marcellus Shale, Pennsylvania ($1.7B for 40% stake); with Pioneer in Eagle Ford, Texas ($1.35B for 45% stake); and with Carrizo. These investments faced challenges when gas prices fell, and RIL eventually exited by 2018, demonstrating how external market conditions affected strategy despite strong entry modes.";
      }
      
      // If no specific navigation request is recognized, return false
      return false;
    }
    
    async function sendMessage() {
      const userInput = document.getElementById('user-input');
      const userMessage = userInput.value.trim();
      if (userMessage === '' || isWaitingForResponse) return;
      
      isWaitingForResponse = true;
      document.getElementById('send-button').disabled = true;
      
      const timestamp = getCurrentTimestamp();
      const message = {
        type: 'user',
        text: userMessage,
        timestamp
      };
      
      // Add user message to UI and history
      addMessageToUI(message);
      chatHistory.push(message);
      saveChatHistory();
      
      // Clear input and reset height
      userInput.value = '';
      userInput.style.height = 'auto';
      
      // Show typing indicator
      showTypingIndicator();
      
      // Check if this is a map navigation request
      const navigationResponse = handleMapNavigationRequest(userMessage);
      
      if (navigationResponse) {
        // Handle map navigation requests with a realistic delay
        setTimeout(() => {
          removeTypingIndicator();
          
          const botMessage = {
            type: 'bot',
            text: navigationResponse,
            timestamp: getCurrentTimestamp()
          };
          
          addMessageToUI(botMessage);
          chatHistory.push(botMessage);
          saveChatHistory();
          
          isWaitingForResponse = false;
          document.getElementById('send-button').disabled = userInput.value.trim() === '';
          userInput.focus();
        }, 1500);
      } else {
        // Regular chat response
        try {
          // For Gemini 2.0 flash API, using a simpler format as it doesn't support full chat history
          // We'll include the system context and the current user message
          
          // API call
          const response = await fetch(`${CHATBOT_CONFIG.API_URL}?key=${CHATBOT_CONFIG.API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{
                parts: [
                  { text: `Context: ${CHATBOT_CONFIG.SYSTEM_CONTEXT}\n\nUser's question: ${userMessage}` }
                ]
              }]
            })
          });
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error("API Error Response:", errorText);
            let errorMessage = `Error ${response.status}: ${response.statusText}`;
            try {
              const errorData = JSON.parse(errorText);
              if (errorData.error && errorData.error.message) {
                errorMessage = `Error ${response.status}: ${errorData.error.message}`;
              }
            } catch (e) {
              console.error("Error parsing error response:", e);
            }
            throw new Error(errorMessage);
          }
          
          const data = await response.json();
          
          removeTypingIndicator();
          
          if (data && data.candidates && data.candidates[0] && data.candidates[0].content) {
            const botMessage = {
              type: 'bot',
              text: data.candidates[0].content.parts[0].text,
              timestamp: getCurrentTimestamp()
            };
            
            addMessageToUI(botMessage);
            chatHistory.push(botMessage);
            saveChatHistory();
          } else {
            throw new Error('Invalid response format');
          }
        } catch (error) {
          console.error('Error:', error);
          removeTypingIndicator();
          
          // Add error message
          const errorMessage = {
            type: 'system',
            text: `Error: ${error.message || 'Failed to get response from assistant'}`,
            isError: true
          };
          addMessageToUI(errorMessage);
        } finally {
          // Always reset waiting state and re-enable the send button regardless of success/failure
          isWaitingForResponse = false;
          document.getElementById('send-button').disabled = userInput.value.trim() === '';
          userInput.focus();
        }
      }
    }
    
    // History management
    function saveChatHistory() {
      // Trim history if too long
      const MAX_HISTORY_LENGTH = 50;
      if (chatHistory.length > MAX_HISTORY_LENGTH) {
        chatHistory = chatHistory.slice(-MAX_HISTORY_LENGTH);
      }
      try {
        localStorage.setItem(CHATBOT_CONFIG.STORAGE_KEY, JSON.stringify(chatHistory));
      } catch (e) {
        console.error('Error saving chat history:', e);
        // Add fallback if localStorage is full or unavailable
      }
    }
    
    function loadChatHistory() {
      try {
        const savedHistory = localStorage.getItem(CHATBOT_CONFIG.STORAGE_KEY);
        if (savedHistory) {
          chatHistory = JSON.parse(savedHistory);
          
          // Render chat history
          const messagesContainer = document.getElementById('messages');
          messagesContainer.innerHTML = '';
          chatHistory.forEach(message => {
            addMessageToUI(message);
          });
        }
      } catch (error) {
        console.error('Error loading chat history:', error);
        chatHistory = [];
      }
    }
    
    function clearChatHistory() {
      chatHistory = [];
      localStorage.removeItem(CHATBOT_CONFIG.STORAGE_KEY);
      document.getElementById('messages').innerHTML = '';
      displayWelcomeMessage();
    }
    
    // Initialize chat functionality
    function initChat() {
      loadChatHistory();
      displayWelcomeMessage();
      
      const userInput = document.getElementById('user-input');
      const sendButton = document.getElementById('send-button');
      const clearChatButton = document.getElementById('clear-chat');
      
      // Textarea auto-resize
      userInput.addEventListener('input', () => {
        // Enable/disable send button based on input
        sendButton.disabled = userInput.value.trim() === '';
        
        // Auto-resize the textarea
        userInput.style.height = 'auto';
        const maxHeight = 150;
        userInput.style.height = (userInput.scrollHeight < maxHeight) ? 
          userInput.scrollHeight + 'px' : maxHeight + 'px';
      });
      
      // Send on Enter (but Shift+Enter for new line)
      userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          if (!isWaitingForResponse && userInput.value.trim() !== '') {
            sendMessage();
          }
        }
      });
      
      // Send button click
      sendButton.addEventListener('click', () => {
        if (!isWaitingForResponse && userInput.value.trim() !== '') {
          sendMessage();
        }
      });
      
      // Clear chat history with confirmation
      clearChatButton.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear the entire chat history?')) {
          clearChatHistory();
        }
      });

      // Quick question buttons
      document.querySelectorAll('.quick-question-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          if (!isWaitingForResponse) {
            const question = this.getAttribute('data-question');
            userInput.value = question;
            sendButton.disabled = false;
            // Trigger send
            sendMessage();
          }
        });
      });
    }

    // Event listeners for filtering controls in Map View
    document.getElementById("filter-operations").addEventListener("change", updateMarkers);
    document.getElementById("filter-partnerships").addEventListener("change", updateMarkers);
    document.getElementById("filter-opportunities").addEventListener("change", updateMarkers);
    document.getElementById("filter-status").addEventListener("change", updateMarkers);
    
    document.getElementById("time-slider").addEventListener("input", function() {
      document.getElementById("timeLabel").innerText = this.value;
      updateMarkers();
    });
    
    document.getElementById("timeline-slider").addEventListener("input", updateTimeline);

    // Close modal when clicking outside the content
    window.onclick = function(event) {
      const modal = document.getElementById("detailModal");
      if (event.target === modal) {
        closeModal();
      }
    };

    // Initialize the app when the page loads
    window.onload = function() {
      // Initialize all views
      initMap();
      createMarkers();
      updateMarkers();
      updateTimeline();
      initChat();
      
      // Mobile detection and adjustment
      if (window.innerWidth <= 768) {
        sidebarExpanded = false;
        document.getElementById('sidebar').classList.remove('expanded');
      }
      
      // Focus on the chat input when switching to chat view
      document.getElementById('btn-chat').addEventListener('click', () => {
        setTimeout(() => {
          document.getElementById('user-input').focus();
        }, 500);
      });
      
      // Ensure floating chat button works properly
      document.getElementById('chat-fab').addEventListener('click', () => {
        switchView('view-chat');
        setTimeout(() => {
          document.getElementById('user-input').focus();
        }, 500);
      });
    };
  </script>
</body>
</html>
